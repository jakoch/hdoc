#
# .github/workflows/build-on-linux.yml
#
# Copyright 2021 Jens A. Koch.
# SPDX-License-Identifier: AGPL-3.0-only
# This file is part of https://github.com/jakoch/hdoc.
#

name: "Build"

on:  
  push:
  pull_request:
  # Add button to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:

# ---------------------------------------------------------------------------------------

  build:

# ---------------------------------------------------------------------------------------
    
    name: "Build"
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
    - name: 🔽 Install wget gnupg
      run: | 
           sudo apt-get -y update
           sudo apt-get -y install wget gnupg     
           
    - name: 🔽 Add package source for LLVM 12
      run: |    
        sudo tee /etc/apt/sources.list.d/llvm.list >/dev/null <<EOF
        deb     http://apt.llvm.org/focal/ llvm-toolchain-focal-12 main
        deb-src http://apt.llvm.org/focal/ llvm-toolchain-focal-12 main
        EOF
        wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add - 
      
    #- name: 🔽 Install Python
    #  run: sudo apt-get install python3 python3-pip python3-setuptools python3-wheel
       
    - name: 🔽 Install build tools
      run: |
           sudo apt-get -y update 
           sudo apt-get -y install \
                 build-essential \
                 meson \
                 ninja-build \
                 cmake \
                 xxd \
                 clang-12 \
                 libclang-common-12-dev \
                 libclang-12-dev \
                 lld-12 \
                 groff \
                 unzip \
                 pkg-config \
                 git \
                 zlib1g-dev \
                 libssl-dev \
                 libcurl4-openssl-dev
                 
    - name: Update LLVM version 
      run: | 
        sudo update-alternatives --install /usr/bin/llvm-config llvm-config /usr/bin/llvm-config-12 12
        sudo update-alternatives --config llvm-config
      
    - name: ✏ Build using meson
      run: meson build 
      
    - name: 🙏 Compile using Ninja
      run: ninja -C build
      
    - name: ❔ Show important Files and Folders
      run: ls -lahr
           
